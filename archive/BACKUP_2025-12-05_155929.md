# Plena Project Snapshot

**Timestamp:** December 5, 2025 - 15:59:29
**Purpose:** Pre-Zone Classification Implementation Snapshot

---

## Project Status

### Current Features

#### ✅ Implemented & Working

1. **Meditation Session Tracking**

   - Start/stop sessions with 3-2-1 countdown
   - Real-time sensor data collection (HR, HRV, Respiratory Rate, VO₂ Max, Temperature)
   - Session summaries
   - Local storage via CoreDataStorageService

2. **HealthKit Integration**

   - Read sensor data in real-time
   - Save mindful sessions to HealthKit on completion
   - Query historical mindful sessions
   - VO₂ Max and Temperature baseline tracking

3. **Dashboard**

   - Session statistics and trends
   - Duration trend charts
   - Session frequency charts
   - Stat cards with key metrics

4. **Data Visualization**

   - Time range selection (Day/Week/Month/Year)
   - Sensor type selection (Heart Rate/HRV/Respiratory Rate/VO₂ Max/Temperature)
   - Charts with trend indicators
   - Date-range optimized loading
   - Smart axis label formatting

5. **Settings System**

   - Sensor toggle controls (Heart Rate, HRV, Respiratory Rate, VO₂ Max, Temperature)
   - Temperature unit preference (Celsius/Fahrenheit)
   - Settings sync between iOS and Watch via iCloud Key-Value Store

6. **Apple Watch Integration**
   - Start/Stop meditation sessions with 3-2-1 countdown
   - Display sensors with scrolling
   - Respects settings from iPhone
   - Temperature unit conversion

---

## Current File Structure

### Models

- `HeartRateSample.swift` - Basic model with value (BPM) and timestamp
- `HRVSample.swift` - Basic model with sdnn (ms) and timestamp
- `MeditationSession.swift` - Container for all sensor samples
- Other sensor models (RespiratoryRate, VO2Max, Temperature, StateOfMindLog)

### ViewModels

- `MeditationSessionViewModel.swift` - Manages session state and real-time sensor values
  - `@Published var currentHeartRate: Double?`
  - `@Published var currentHRV: Double?`
  - No zone classification currently

### Views

- `MeditationSessionView.swift` - iOS session tracking view
  - Uses `SensorValueCard` component for displaying values
  - Shows raw numeric values only
- `MeditationWatchView.swift` - Watch session tracking view
  - Shows raw numeric values only

### Components

- `SensorValueCard` - Reusable card component for displaying sensor values
  - Takes: icon, iconColor, value, unit, label, size
  - No zone/color coding currently

---

## Planned Feature: Zone Classification

### Feature Description

Auto-classify Heart Rate and HRV readings into color-coded stress zones:

- **Calm** (Low stress/restful state)
- **Optimal** (Normal/healthy range)
- **Elevated Stress** (High stress/arousal)

### Implementation Plan

1. **New Files to Create:**

   - `PlenaShared/Models/StressZone.swift` - Zone enum with colors
   - `PlenaShared/Services/ZoneClassifier.swift` - Classification logic

2. **Files to Modify:**

   - `MeditationSessionViewModel.swift` - Add zone calculation
   - `MeditationSessionView.swift` - Update SensorValueCard to show zones
   - `MeditationWatchView.swift` - Update to show zones
   - `SensorValueCard` - Add zone visualization

3. **Zone Classification Logic:**

   **Heart Rate:**

   - Calm: < 60 bpm (or below personal baseline -10%)
   - Optimal: 60-100 bpm (or within ±10% of baseline)
   - Elevated Stress: > 100 bpm (or above baseline +15%)

   **HRV (SDNN):**

   - Elevated Stress: < 50 ms
   - Optimal: 50-100 ms
   - Calm: > 100 ms

### Design Considerations

- Color scheme: Calm (Blue), Optimal (Green), Elevated Stress (Orange/Red)
- Visual indicator: Border/background on SensorValueCard
- Real-time updates as values change
- Future: Personalization with user baseline tracking

---

## Architecture

- **MVVM Pattern**: Separation of concerns with ViewModels
- **SwiftUI**: Modern declarative UI framework
- **Core Data**: Data persistence (via CoreDataStorageService)
- **HealthKit**: Health and fitness data integration
- **iCloud Key-Value Store**: Settings synchronization
- **Dependency Injection**: Testable components
- **Async/Await**: Modern concurrency patterns

---

## Key Implementation Details

### Current Sensor Display

- Raw numeric values displayed
- Color coding by sensor type (HeartRateColor, HRVColor, etc.)
- No stress zone interpretation

### Planned Zone Display

- Visual zone indicator (border/background color)
- Real-time zone updates
- Maintain existing numeric display
- Accessible design (not color-only)

---

**Snapshot Created:** December 5, 2025 - 15:59:29
**Project Version:** Pre-Zone Classification Implementation
**Status:** All existing features working, ready for zone classification feature


