# Plena Project Snapshot

**Timestamp:** December 5, 2025, 08:39:51
**Date Format:** 2025-12-05_083951

## Project Status

### Current Implementation State

#### Recent Work

- ✅ Time axis labels implementation (`PlenaTimeAxisLabels.swift`)
- ✅ Axis label settings view (`AxisLabelSettingsView.swift`)
- ✅ Multiple axis label formatter implementations
- ✅ Settings system with iCloud sync
- ✅ Dashboard with statistics and trends
- ✅ Data visualization with charts
- ✅ Apple Watch companion app

### Architecture

- **MVVM Pattern**: Separation of concerns with ViewModels
- **SwiftUI**: Modern declarative UI framework
- **Core Data**: Data persistence via `CoreDataStack` and `CoreDataStorageService`
- **HealthKit**: Health and fitness data integration
- **iCloud Key-Value Store**: Settings synchronization
- **Dependency Injection**: Testable components
- **Async/Await**: Modern concurrency patterns

### Project Structure

```
Plena/
├── Plena/                          # iOS App
│   ├── PlenaApp.swift
│   ├── ContentView.swift          # Tab navigation
│   ├── Views/
│   │   ├── SettingsView.swift
│   │   ├── MeditationSessionView.swift
│   │   ├── DashboardView.swift
│   │   ├── DataVisualizationView.swift
│   │   ├── SessionSummaryView.swift
│   │   ├── GraphView.swift
│   │   ├── TestDataView.swift
│   │   ├── AxisLabelSettingsView.swift
│   │   └── Components/
│   │       ├── StatCard.swift
│   │       ├── SessionFrequencyChart.swift
│   │       └── DurationTrendChart.swift
│   └── Plena.entitlements        # iCloud configured
│
├── Plena Watch App/               # watchOS App
│   ├── PlenaWatchApp.swift
│   ├── Views/
│   │   ├── MeditationWatchView.swift
│   │   └── WatchContentView.swift
│   └── Plena Watch App.entitlements   # iCloud configured
│
└── PlenaShared/                   # Shared code
    ├── Models/
    │   ├── MeditationSession.swift
    │   ├── MeditationSessionData.swift
    │   ├── HeartRateSample.swift
    │   ├── HRVSample.swift
    │   ├── RespiratoryRateSample.swift
    │   ├── TemperatureSample.swift
    │   ├── VO2MaxSample.swift
    │   ├── SessionSummary.swift
    │   ├── StateOfMindLog.swift
    │   └── PlenaDataModel.xcdatamodeld/
    ├── Services/
    │   ├── CoreDataStack.swift
    │   ├── CoreDataStorageService.swift
    │   ├── SwiftDataStorageService.swift
    │   ├── SessionStorageService.swift
    │   ├── HealthKitService.swift
    │   ├── HealthKitImportService.swift
    │   └── TestDataGenerator.swift
    └── ViewModels/
        ├── MeditationSessionViewModel.swift
        ├── DashboardViewModel.swift
        ├── DataVisualizationViewModel.swift
        ├── SettingsViewModel.swift
        ├── PlenaTimeAxisLabels.swift
        ├── AxisLabelImplementation.swift
        ├── SmartAxisLabelFormatter.swift
        ├── TimeRange.swift
        └── SensorTypes.swift
```

### Key Features

#### 1. Meditation Session Tracking

- Real-time session tracking
- Start/stop functionality
- 3-2-1 countdown
- Sensor data collection (HR, HRV, Respiratory Rate, VO₂ Max, Temperature)
- Local storage with Core Data

#### 2. HealthKit Integration

- Real-time sensor data reading
- Save mindful sessions to HealthKit
- Historical data querying
- Import service for historical data

#### 3. Dashboard

- Statistics overview
- Session frequency charts
- Duration trend visualization
- Stat cards for key metrics

#### 4. Data Visualization

- Time range selection (Day/Week/Month/Year)
- Sensor type selection
- Charts with trend indicators
- Date-range optimized loading
- Custom time axis labels

#### 5. Settings System

- Sensor toggle controls (Heart Rate, HRV, Respiratory Rate, VO₂ Max, Temperature)
- Temperature unit preference (Celsius/Fahrenheit)
- iCloud Key-Value Store sync between iOS and Watch
- Persistent settings

#### 6. Time Axis Labels

- Custom axis label implementation (`PlenaTimeAxisLabels.swift`)
- Support for Day/Week/Month/Year granularities
- Smart label formatting
- Settings view for axis label customization

### Current Files

#### Views (iOS)

- `ContentView.swift` - Main tab navigation
- `MeditationSessionView.swift` - Meditation interface
- `DashboardView.swift` - Statistics dashboard
- `DataVisualizationView.swift` - Chart visualization
- `SessionSummaryView.swift` - Session summary
- `SettingsView.swift` - App settings
- `GraphView.swift` - Reusable chart component
- `TestDataView.swift` - Test data generation UI
- `AxisLabelSettingsView.swift` - Axis label settings

#### View Components

- `StatCard.swift` - Statistics card component
- `SessionFrequencyChart.swift` - Frequency bar chart
- `DurationTrendChart.swift` - Duration trend line chart

#### ViewModels

- `MeditationSessionViewModel.swift` - Session tracking logic
- `DashboardViewModel.swift` - Dashboard statistics
- `DataVisualizationViewModel.swift` - Data visualization logic
- `SettingsViewModel.swift` - Settings management with iCloud sync
- `PlenaTimeAxisLabels.swift` - Time axis label generation
- `AxisLabelImplementation.swift` - Axis label implementation
- `SmartAxisLabelFormatter.swift` - Smart label formatting
- `TimeRange.swift` - Time range enum and utilities
- `SensorTypes.swift` - Sensor type definitions

#### Services

- `CoreDataStack.swift` - Core Data stack setup
- `CoreDataStorageService.swift` - Core Data persistence
- `SwiftDataStorageService.swift` - SwiftData persistence (alternative)
- `SessionStorageService.swift` - JSON fallback storage
- `HealthKitService.swift` - HealthKit integration
- `HealthKitImportService.swift` - Historical data import
- `TestDataGenerator.swift` - Test data generation

#### Models

- `MeditationSession.swift` - Session model
- `MeditationSessionData.swift` - Session data container
- `HeartRateSample.swift` - Heart rate data
- `HRVSample.swift` - HRV data
- `RespiratoryRateSample.swift` - Respiratory rate data
- `TemperatureSample.swift` - Temperature data
- `VO2MaxSample.swift` - VO₂ Max data
- `SessionSummary.swift` - Session summary model
- `StateOfMindLog.swift` - State of mind logging

### Settings Sync

**Method:** iCloud Key-Value Store (NSUbiquitousKeyValueStore)

- Automatic sync between iOS and Watch
- Polling interval: 2 seconds (backup mechanism)
- Notification-based updates for real-time sync

**Settings Keys:**

- `sensorHeartRateEnabled` (Bool)
- `sensorHRVEnabled` (Bool)
- `sensorRespiratoryRateEnabled` (Bool)
- `sensorVO2MaxEnabled` (Bool)
- `sensorTemperatureEnabled` (Bool)
- `temperatureUnit` (String: "°C" or "°F")

### Recent Changes

1. **Time Axis Labels Implementation**

   - Created `PlenaTimeAxisLabels.swift` for custom axis label generation
   - Support for Day/Week/Month/Year granularities
   - Smart label formatting based on time range
   - Settings view for axis label customization

2. **Axis Label Formatters**

   - Multiple formatter implementations
   - `SmartAxisLabelFormatter.swift` for intelligent formatting
   - `AxisLabelImplementation.swift` for alternative approaches

3. **Settings System**
   - iCloud Key-Value Store sync
   - Sensor toggles and temperature unit preference
   - Cross-device synchronization

### Testing Notes

- Settings sync requires physical devices on same iCloud account
- Time axis labels tested for all granularities
- HealthKit integration requires proper entitlements
- Core Data migrations handled via `PlenaDataModel.xcdatamodeld`

### Dependencies

- SwiftUI
- Core Data
- HealthKit
- CloudKit (via iCloud Key-Value Store)
- Foundation

### Build Configuration

- iOS Deployment Target: (check project settings)
- watchOS Deployment Target: (check project settings)
- Swift Version: (check project settings)
- Xcode Project: `Plena.xcodeproj`

---

## Snapshot Metadata

**Created:** December 5, 2025, 08:39:51
**Format:** Markdown
**Purpose:** Project state backup and reference
**Version:** Time Axis Labels Implementation

---

## Rollback Instructions

If needed to revert to this state:

1. Review git history for this timestamp
2. Check file modifications since this snapshot
3. Restore from version control if available
4. Reference this document for file structure

---

**Note:** This snapshot captures the project state at the time of creation. For detailed code changes, refer to version control history.
